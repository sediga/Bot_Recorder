(()=>{function f(i){let a={};for(let o of i.attributes)o.name&&o.value&&(a[o.name]=o.value);return a}(function(){if(window.__recorderInjected)return;window.__recorderInjected=!0,console.log("[Botflows] Recorder script injected successfully");let i={selector:null,timestamp:0},a={selector:null,timestamp:0},o=window.getSmartSelectorLib.getSmartSelector,p=()=>window.__pickModeActive===!0,g=(e,r={})=>{if(p())return;let l=e.target,t=l.closest('a, button, input[type="button"], [role="button"]')||l,n=e.type;if(!t||t===document||t===document.body||!document.contains(t)||typeof window.sendEventToPython!="function")return;let s=o(t),u=Date.now();if(n==="click"&&s===i.selector&&u-i.timestamp<80)return;if(n==="focus"){let d=t.tagName.toLowerCase();if(!["input","textarea","select"].includes(d))return}n==="click"&&(i={selector:s,timestamp:u}),n==="focus"&&(a={selector:s,timestamp:u});let b={action:n==="input"?"type":n,selector:s,timestamp:u,value:t.value||null,url:window.location.href,tagName:t.tagName||null,classList:Array.from(t.classList||[]),attributes:f(t),innerText:t.innerText||null,elementText:t.textContent||null,...r};if(window.sendEventToPython(b),window.parent.postMessage({type:"recorded-event",data:b},"*"),n==="click"&&typeof window.sendLogToPython=="function"){let d=t.parentElement?.tagName?.toLowerCase()||null,h=Array.from(t.parentElement?.children||[]).filter(m=>m!==t).map(m=>m.innerText.trim()).filter(Boolean);window.sendLogToPython({event:"click",selector:s,elementMeta:{tag:t.tagName.toLowerCase(),attributes:f(t),innerText:t.innerText?.trim(),parentTag:d,siblingText:h},timestamp:new Date().toISOString(),pageUrl:window.location.href})}};["click","focus","change"].forEach(e=>{document.addEventListener(e,g,!0)}),document.addEventListener("blur",e=>{if(p())return;let r=e.target;r.matches("input, textarea, select")&&g(e,{action:"type",value:r.value})},!0);let c=()=>{typeof window.sendUrlChangeToPython=="function"&&window.sendUrlChangeToPython(window.location.href)},w=()=>{document.body?new MutationObserver(c).observe(document.body,{childList:!0,subtree:!0}):setTimeout(w,100)};w();let y=e=>{let r=history[e];history[e]=function(...l){r.apply(this,l),c()}};window.addEventListener("popstate",c),c(),y("pushState"),y("replaceState")})();})();
