(()=>{function x(t){let o={};for(let e of t.attributes)e.name&&e.value&&(o[e.name]=e.value);return o}function A(t){if(!t||!t.textContent)return"";let o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),e=[];for(;o.nextNode();){let n=o.currentNode.textContent.trim().replace(/\s+/g," ");n&&n.length<100&&e.push(n)}return e.length===0?"":e.sort((n,a)=>n.length-a.length)[0].replace(/["']/g,"")}function C(t){let o=t.tagName.toLowerCase(),e=t.getAttribute("role")||"",i=Array.from(t.classList).join(" ").toLowerCase();return["a","button"].includes(o)||["button","link"].includes(e)||t.hasAttribute("onclick")||t.hasAttribute("tabindex")||/cursor-pointer|clickable|btn|card|link|action|nav/i.test(i)}function N(t){let o=["BODY","HTML","MAIN"],e=[/^min-h-screen$/,/^bg-/,/^text-/];return!t||o.includes(t.tagName)?!0:Array.from(t.classList).some(n=>e.some(a=>a.test(n)))}function $(t){for(;t&&t!==document.body&&!C(t)&&!N(t);)t=t.parentElement;return t}function T(t){if(!t||t.length<6)return!1;if(t.length>16)return!0;if(/^[A-Za-z0-9_-]{10,}$/.test(t)){let o=/[a-z]/.test(t)&&/[A-Z]/.test(t),e=/\d/.test(t);return o&&e}return!1}function w(t){if(!t||t===document||t.nodeType!==1)return"";if(t.tagName==="SPAN"&&t.textContent.trim()==="*"){let s=t.closest("label");if(s?.htmlFor)return`#${CSS.escape(s.htmlFor)}`;let c=t.closest("div")?.querySelector("input, textarea, select");if(c)return w(c)}if(t.tagName==="LABEL"&&t.htmlFor)return`#${CSS.escape(t.htmlFor)}`;if(["DIV","SPAN"].includes(t.tagName)){let s=t.querySelector("label[for]");if(s){let l=document.getElementById(s.htmlFor);if(l)return w(l)}let c=t.querySelector("input, textarea, select");if(c)return w(c)}let e=t.matches("input, textarea, select")?t:$(t)||t,i=e.tagName.toLowerCase(),n=A(e);if(e.getAttribute("data-testid"))return`[data-testid="${CSS.escape(e.getAttribute("data-testid"))}"]`;let a=e.getAttribute("aria-label");if(a){let s=e.closest('div[role="columnheader"][data-field]');if(s){let c=s.getAttribute("data-field");return`div[role="columnheader"][data-field="${CSS.escape(c)}"] [aria-label="${CSS.escape(a)}"]`}return`[aria-label="${CSS.escape(a)}"]`}if(e.id&&!T(e.id))return`#${CSS.escape(e.id)}`;if(e.name)return`[name="${CSS.escape(e.name)}"]`;if(e.placeholder)return`[placeholder="${CSS.escape(e.placeholder)}"]`;if(e.getAttribute("role")==="columnheader"&&e.hasAttribute("data-field"))return`div[role="columnheader"][data-field="${CSS.escape(e.getAttribute("data-field"))}"]`;if(i==="button"&&n)return`button:has-text("${n}")`;if(i==="a"&&n)return`a:has-text("${n}")`;let p=e.getAttribute("type"),u=e.getAttribute("role");if(i==="input"&&p==="button"&&e.value)return`input[type="button"][value="${CSS.escape(e.value)}"]`;if((u==="button"||u==="link")&&n)return`[role="${CSS.escape(u)}"]:has-text("${n}")`;let m=Array.from(e.classList).filter(s=>/^[a-zA-Z0-9_-]+$/.test(s)),g="";m.length&&(g="."+m.slice(0,3).map(CSS.escape).join("."));let r=`${i}${g}`;n&&(r+=`:has-text("${n}")`);let f=Array.from(document.querySelectorAll(i)).filter(s=>s.textContent?.includes(n));if(f.length>1){let s=f.indexOf(e);s>=0&&(r+=`:nth-of-type(${s+1})`)}return r.startsWith('body:has-text("*")')?"":r}function L(t){if(!(t instanceof Element))return"";let o=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id){e=`#${CSS.escape(t.id)}`,o.unshift(e);break}else{let n=(t.className||"").toString().trim().replace(/\s+/g,".");n&&(e+="."+n.replace(/^\.+/,""))}let i=t.parentNode;if(i){let n=Array.from(i.children).filter(a=>a.tagName===t.tagName);if(n.length>1){let a=n.indexOf(t)+1;e+=`:nth-child(${a})`}}o.unshift(e),t=t.parentNode}return o.join(" > ")}function v(t){if(!t)return null;let o=[],e=x(t),i=t.tagName.toLowerCase();if(t.id&&o.push({selector:`#${CSS.escape(t.id)}`,source:"id",score:100}),t.getAttribute("data-testid")&&o.push({selector:`[data-testid="${t.getAttribute("data-testid")}"]`,source:"data-testid",score:90}),t.getAttribute("aria-label")&&o.push({selector:`[aria-label="${t.getAttribute("aria-label")}"]`,source:"aria-label",score:85}),t.getAttribute("name")&&o.push({selector:`[name="${t.getAttribute("name")}"]`,source:"name",score:80}),t.classList.length){let a=`${i}.${[...t.classList].map(p=>CSS.escape(p)).join(".")}`;o.push({selector:a,source:"class",score:70})}let n=t.innerText?.trim();return n&&o.push({selector:`${i}:has-text("${n.slice(0,50)}")`,source:"has-text",score:40}),o.push({selector:k(t),source:"dom-path",score:30}),o.push({selector:_(t),source:"xpath",score:20}),{text:n,selectors:o,attributes:e,boundingBox:t.getBoundingClientRect?.()||null}}function k(t){let o=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id)e+=`#${CSS.escape(t.id)}`;else{let i=Array.from(t.parentNode?.children||[]).filter(n=>n.nodeName===t.nodeName);if(i.length>1){let n=i.indexOf(t);e+=`:nth-of-type(${n+1})`}}o.unshift(e),t=t.parentElement}return o.join(" > ")}function _(t){if(t.id)return`//*[@id="${t.id}"]`;let o=[];for(;t&&t.nodeType===1;){let e=1,i=t.previousSibling;for(;i;)i.nodeType===1&&i.tagName===t.tagName&&e++,i=i.previousSibling;let n=t.tagName.toLowerCase(),a=e>1?`${n}[${e}]`:n;o.unshift(a),t=t.parentNode}return"/"+o.join("/")}window.getSmartSelectorLib={getSmartSelector:w,getDevtoolsLikeSelector:L};(function(){if(console.debug("[Botflows] Recorder script starting execution..."),window.__recorderInjected){console.debug(`[Botflows] Recorder already injected at ${window.__recorderInjectedTime}, skipping.`);return}window.__recorderInjected=!0,window.__recorderInjectedTime=new Date().toISOString(),console.debug("[Botflows] Recorder script injected successfully");let t={selector:null,timestamp:0},o={selector:null,timestamp:0},e=()=>window.__pickModeActive===!0;function i(){if(document.getElementById("__botflows_validation_overlay"))return;let r=document.createElement("div");r.id="__botflows_validation_overlay",Object.assign(r.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(255, 255, 255, 0.6)",zIndex:999999,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",fontFamily:"sans-serif",fontWeight:"bold",color:"#333"}),r.innerText="Validating action\u2026 Please wait",document.body.appendChild(r)}function n(){let r=document.getElementById("__botflows_validation_overlay");r&&r.remove()}window.hideValidationOverlay=n;let a=(r,d={})=>{if(e()){console.debug("[Botflows] In pick mode \u2014 event suppressed:",r.type);return}if(window.__pendingValidation){console.debug("[Botflows] Skipping event while previous validation is pending");return}let f=r.target,s=f.closest('a, button, input[type="button"], [role="button"]')||f,c=r.type;if(!s||s===document||s===document.body||!document.contains(s)||typeof window.sendEventToPython!="function"){console.debug("[Botflows] Ignoring untrackable target:",s);return}let l=v(s);if(!l||!l.selectors?.length)return;let h=Date.now(),b=l.selectors[0].selector;if(c==="click"&&b===t.selector&&h-t.timestamp<80){console.debug("[Botflows] Suppressed duplicate click:",b);return}if(c==="focus"){let S=s.tagName.toLowerCase();if(!["input","textarea","select"].includes(S)){console.debug("[Botflows] Ignored focus event on non-input element:",S);return}}c==="click"&&(t={selector:b,timestamp:h}),c==="focus"&&(o={selector:b,timestamp:h});let y={action:c==="input"?"type":c,selector:b,selectors:l.selectors,timestamp:h,value:s.value||null,url:window.location.href,tagName:s.tagName||null,classList:Array.from(s.classList||[]),attributes:l.attributes,innerText:l.text,elementText:s.textContent||null,boundingBox:l.boundingBox,...d};console.debug("[Botflows] Sending event to Python:",y),window.__pendingValidation=!0,i(),window.sendEventToPython(y)};["click","focus","change","dblclick"].forEach(r=>{document.addEventListener(r,a,!0),console.debug(`[Botflows] Event listener attached for ${r}`)}),document.addEventListener("blur",r=>{if(e()){console.debug("[Botflows] Blur event suppressed in pick mode");return}let d=r.target;d.matches("input, textarea, select")&&(console.debug("[Botflows] Blur captured as type event"),a(r,{action:"type",value:d.value}))},!0);let p=window.location.href,u=()=>{let r=window.location.href;r!==p&&typeof window.sendUrlChangeToPython=="function"&&(p=r,console.debug("[Botflows] Detected SPA URL change:",r),window.sendUrlChangeToPython(r))},m=()=>{document.body?(console.debug("[Botflows] Setting up mutation observer for body"),new MutationObserver(u).observe(document.body,{childList:!0,subtree:!0})):setTimeout(m,100)};m();let g=r=>{let d=history[r];history[r]=function(...f){d.apply(this,f),console.debug(`[Botflows] Intercepted history.${r}`),u()}};window.addEventListener("popstate",u),u(),g("pushState"),g("replaceState")})();})();
