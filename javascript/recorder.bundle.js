(()=>{function x(t){let s={};for(let e of t.attributes)e.name&&e.value&&(s[e.name]=e.value);return s}function k(t){if(!t||!t.textContent)return"";let s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),e=[];for(;s.nextNode();){let n=s.currentNode.textContent.trim().replace(/\s+/g," ");n&&n.length<100&&e.push(n)}return e.length===0?"":e.sort((n,i)=>n.length-i.length)[0].replace(/["']/g,"")}function L(t){let s=t.tagName.toLowerCase(),e=t.getAttribute("role")||"",o=Array.from(t.classList).join(" ").toLowerCase();return["a","button"].includes(s)||["button","link"].includes(e)||t.hasAttribute("onclick")||t.hasAttribute("tabindex")||/cursor-pointer|clickable|btn|card|link|action|nav/i.test(o)}function N(t){let s=["BODY","HTML","MAIN"],e=[/^min-h-screen$/,/^bg-/,/^text-/];return!t||s.includes(t.tagName)?!0:Array.from(t.classList).some(n=>e.some(i=>i.test(n)))}function $(t){for(;t&&t!==document.body&&!L(t)&&!N(t);)t=t.parentElement;return t}function C(t){if(!t||t.length<6)return!1;if(t.length>16)return!0;if(/^[A-Za-z0-9_-]{10,}$/.test(t)){let s=/[a-z]/.test(t)&&/[A-Z]/.test(t),e=/\d/.test(t);return s&&e}return!1}function b(t){if(!t||t===document||t.nodeType!==1)return"";if(t.tagName==="SPAN"&&t.textContent.trim()==="*"){let r=t.closest("label");if(r?.htmlFor)return`#${CSS.escape(r.htmlFor)}`;let u=t.closest("div")?.querySelector("input, textarea, select");if(u)return b(u)}if(t.tagName==="LABEL"&&t.htmlFor)return`#${CSS.escape(t.htmlFor)}`;if(["DIV","SPAN"].includes(t.tagName)){let r=t.querySelector("label[for]");if(r){let p=document.getElementById(r.htmlFor);if(p)return b(p)}let u=t.querySelector("input, textarea, select");if(u)return b(u)}let e=t.matches("input, textarea, select")?t:$(t)||t,o=e.tagName.toLowerCase(),n=k(e);if(e.getAttribute("data-testid"))return`[data-testid="${CSS.escape(e.getAttribute("data-testid"))}"]`;let i=e.getAttribute("aria-label");if(i){let r=e.closest('div[role="columnheader"][data-field]');if(r){let u=r.getAttribute("data-field");return`div[role="columnheader"][data-field="${CSS.escape(u)}"] [aria-label="${CSS.escape(i)}"]`}return`[aria-label="${CSS.escape(i)}"]`}if(e.id&&!C(e.id))return`#${CSS.escape(e.id)}`;if(e.name)return`[name="${CSS.escape(e.name)}"]`;if(e.placeholder)return`[placeholder="${CSS.escape(e.placeholder)}"]`;if(e.getAttribute("role")==="columnheader"&&e.hasAttribute("data-field"))return`div[role="columnheader"][data-field="${CSS.escape(e.getAttribute("data-field"))}"]`;if(o==="button"&&n)return`button:has-text("${n}")`;if(o==="a"&&n)return`a:has-text("${n}")`;let l=e.getAttribute("type"),g=e.getAttribute("role");if(o==="input"&&l==="button"&&e.value)return`input[type="button"][value="${CSS.escape(e.value)}"]`;if((g==="button"||g==="link")&&n)return`[role="${CSS.escape(g)}"]:has-text("${n}")`;let a=Array.from(e.classList).filter(r=>/^[a-zA-Z0-9_-]+$/.test(r)),f="";a.length&&(f="."+a.slice(0,3).map(CSS.escape).join("."));let m=`${o}${f}`;n&&(m+=`:has-text("${n}")`);let d=Array.from(document.querySelectorAll(o)).filter(r=>r.textContent?.includes(n));if(d.length>1){let r=d.indexOf(e);r>=0&&(m+=`:nth-of-type(${r+1})`)}return m.startsWith('body:has-text("*")')?"":m}function A(t){if(!(t instanceof Element))return"";let s=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id){e=`#${CSS.escape(t.id)}`,s.unshift(e);break}else{let n=(t.className||"").toString().trim().replace(/\s+/g,".");n&&(e+="."+n.replace(/^\.+/,""))}let o=t.parentNode;if(o){let n=Array.from(o.children).filter(i=>i.tagName===t.tagName);if(n.length>1){let i=n.indexOf(t)+1;e+=`:nth-child(${i})`}}s.unshift(e),t=t.parentNode}return s.join(" > ")}function T(t){if(!t||t.nodeType!==1)return null;let s=b(t),e=A(t),o=x(t),n=t.innerText?.trim()||"",i=t.getBoundingClientRect(),l=[];return s&&l.push({strategy:"smart",selector:s}),o["data-testid"]&&l.push({strategy:"testid",selector:`[data-testid="${CSS.escape(o["data-testid"])}"]`}),o.id&&!C(o.id)&&l.push({strategy:"id",selector:`#${CSS.escape(o.id)}`}),o.name&&l.push({strategy:"name",selector:`[name="${CSS.escape(o.name)}"]`}),o["aria-label"]&&l.push({strategy:"aria",selector:`[aria-label="${CSS.escape(o["aria-label"])}"]`}),e&&l.push({strategy:"devtools",selector:e}),{selectors:l,smartSelector:s,devtoolsSelector:e,attributes:o,boundingBox:{x:i.x,y:i.y,width:i.width,height:i.height},text:n}}window.getSmartSelectorLib={getSmartSelector:b,getDevtoolsLikeSelector:A};(function(){if(console.debug("[Botflows] Recorder script starting execution..."),window.__recorderInjected){console.debug(`[Botflows] Recorder already injected at ${window.__recorderInjectedTime}, skipping.`);return}window.__recorderInjected=!0,window.__recorderInjectedTime=new Date().toISOString(),console.debug("[Botflows] Recorder script injected successfully");let t={selector:null,timestamp:0},s={selector:null,timestamp:0},e=()=>window.__pickModeActive===!0,o=(a,f={})=>{if(e()){console.debug("[Botflows] In pick mode \u2014 event suppressed:",a.type);return}let m=a.target,c=m.closest('a, button, input[type="button"], [role="button"]')||m,d=a.type;if(!c||c===document||c===document.body||!document.contains(c)||typeof window.sendEventToPython!="function"){console.debug("[Botflows] Ignoring untrackable target:",c);return}let r=T(c);if(!r||!r.selectors?.length)return;let u=Date.now(),p=r.selectors[0].selector;if(d==="click"&&p===t.selector&&u-t.timestamp<80){console.debug("[Botflows] Suppressed duplicate click:",p);return}if(d==="focus"){let h=c.tagName.toLowerCase();if(!["input","textarea","select"].includes(h)){console.debug("[Botflows] Ignored focus event on non-input element:",h);return}}d==="click"&&(t={selector:p,timestamp:u}),d==="focus"&&(s={selector:p,timestamp:u});let w={action:d==="input"?"type":d,selector:p,selectors:r.selectors,timestamp:u,value:c.value||null,url:window.location.href,tagName:c.tagName||null,classList:Array.from(c.classList||[]),attributes:r.attributes,innerText:r.text,elementText:c.textContent||null,boundingBox:r.boundingBox,...f};if(console.debug("[Botflows] Event recorded:",w),window.sendEventToPython(w),window.parent.postMessage({type:"recorded-event",data:w},"*"),d==="click"&&typeof window.sendLogToPython=="function"){let h=c.parentElement?.tagName?.toLowerCase()||null,v=Array.from(c.parentElement?.children||[]).filter(S=>S!==c).map(S=>S.innerText?.trim()).filter(Boolean),y={event:"click",selector:p,elementMeta:{tag:c.tagName.toLowerCase(),attributes:getAllAttributes(c),innerText:c.innerText?.trim(),parentTag:h,siblingText:v},timestamp:new Date().toISOString(),pageUrl:window.location.href};console.debug("[Botflows] Sending log to Python:",y),window.sendLogToPython(y)}};["click","focus","change","dblclick"].forEach(a=>{document.addEventListener(a,o,!0),console.debug(`[Botflows] Event listener attached for ${a}`)}),document.addEventListener("blur",a=>{if(e()){console.debug("[Botflows] Blur event suppressed in pick mode");return}let f=a.target;f.matches("input, textarea, select")&&(console.debug("[Botflows] Blur captured as type event"),o(a,{action:"type",value:f.value}))},!0);let n=window.location.href,i=()=>{let a=window.location.href;a!==n&&typeof window.sendUrlChangeToPython=="function"&&(n=a,console.debug("[Botflows] Detected SPA URL change:",a),window.sendUrlChangeToPython(a))},l=()=>{document.body?(console.debug("[Botflows] Setting up mutation observer for body"),new MutationObserver(i).observe(document.body,{childList:!0,subtree:!0})):setTimeout(l,100)};l();let g=a=>{let f=history[a];history[a]=function(...m){f.apply(this,m),console.debug(`[Botflows] Intercepted history.${a}`),i()}};window.addEventListener("popstate",i),i(),g("pushState"),g("replaceState")})();})();
