(()=>{function S(t){if(!t||!t.textContent)return"";let s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),e=[];for(;s.nextNode();){let r=s.currentNode.textContent.trim().replace(/\s+/g," ");r&&r.length<100&&e.push(r)}return e.length===0?"":e.sort((r,u)=>r.length-u.length)[0].replace(/["']/g,"")}function w(t){let s=t.tagName.toLowerCase(),e=t.getAttribute("role")||"",i=Array.from(t.classList).join(" ").toLowerCase();return["a","button"].includes(s)||["button","link"].includes(e)||t.hasAttribute("onclick")||t.hasAttribute("tabindex")||/cursor-pointer|clickable|btn|card|link|action|nav/i.test(i)}function x(t){let s=["BODY","HTML","MAIN"],e=[/^min-h-screen$/,/^bg-/,/^text-/];return!t||s.includes(t.tagName)?!0:Array.from(t.classList).some(r=>e.some(u=>u.test(r)))}function A(t){for(;t&&t!==document.body&&!w(t)&&!x(t);)t=t.parentElement;return t}function C(t){if(!t||t.length<6)return!1;if(t.length>16)return!0;if(/^[A-Za-z0-9_-]{10,}$/.test(t)){let s=/[a-z]/.test(t)&&/[A-Z]/.test(t),e=/\d/.test(t);return s&&e}return!1}function g(t){if(!t||t===document||t.nodeType!==1)return"";if(t.tagName==="SPAN"&&t.textContent.trim()==="*"){let o=t.closest("label");if(o?.htmlFor)return`#${CSS.escape(o.htmlFor)}`;let l=t.closest("div")?.querySelector("input, textarea, select");if(l)return g(l)}if(t.tagName==="LABEL"&&t.htmlFor)return`#${CSS.escape(t.htmlFor)}`;if(["DIV","SPAN"].includes(t.tagName)){let o=t.querySelector("label[for]");if(o){let p=document.getElementById(o.htmlFor);if(p)return g(p)}let l=t.querySelector("input, textarea, select");if(l)return g(l)}let e=t.matches("input, textarea, select")?t:A(t)||t,i=e.tagName.toLowerCase(),r=S(e);if(e.getAttribute("data-testid"))return`[data-testid="${CSS.escape(e.getAttribute("data-testid"))}"]`;if(e.getAttribute("aria-label"))return`[aria-label="${CSS.escape(e.getAttribute("aria-label"))}"]`;if(e.id&&!C(e.id))return`#${CSS.escape(e.id)}`;if(e.name)return`[name="${CSS.escape(e.name)}"]`;if(e.placeholder)return`[placeholder="${CSS.escape(e.placeholder)}"]`;if(i==="button"&&r)return`button:has-text("${r}")`;if(i==="a"&&r)return`a:has-text("${r}")`;let u=e.getAttribute("type"),a=e.getAttribute("role");if(i==="input"&&u==="button"&&e.value)return`input[type="button"][value="${CSS.escape(e.value)}"]`;if((a==="button"||a==="link")&&r)return`[role="${CSS.escape(a)}"]:has-text("${r}")`;let c=Array.from(e.classList).filter(o=>/^[a-zA-Z0-9_-]+$/.test(o)),f="";c.length&&(f="."+c.slice(0,3).map(CSS.escape).join("."));let n=`${i}${f}`;r&&(n+=`:has-text("${r}")`);let m=Array.from(document.querySelectorAll(i)).filter(o=>o.textContent?.includes(r));if(m.length>1){let o=m.indexOf(e);o>=0&&(n+=`:nth-of-type(${o+1})`)}return n.startsWith('body:has-text("*")')?"":n}function h(t){let s={};for(let e of t.attributes)e.name&&e.value&&(s[e.name]=e.value);return s}(function(){if(window.__recorderInjected)return;window.__recorderInjected=!0,console.log("[Botflows] Recorder script injected successfully");let t={selector:null,timestamp:0},s={selector:null,timestamp:0},e=(a,c={})=>{let f=a.target,n=f.closest('a, button, input[type="button"], [role="button"]')||f,d=a.type;if(!n||n===document||n===document.body||!document.contains(n)||typeof window.sendEventToPython!="function")return;let m=g(n),o=Date.now();if(d==="click"&&m===t.selector&&o-t.timestamp<80)return;if(d==="focus"){let p=n.tagName.toLowerCase();if(!["input","textarea","select"].includes(p))return}d==="click"&&(t={selector:m,timestamp:o}),d==="focus"&&(s={selector:m,timestamp:o});let l={action:d==="input"?"type":d,selector:m,timestamp:o,value:n.value||null,url:window.location.href,tagName:n.tagName||null,classList:Array.from(n.classList||[]),attributes:h(n),innerText:n.innerText||null,elementText:n.textContent||null,...c};if(window.sendEventToPython(l),window.parent.postMessage({type:"recorded-event",data:l},"*"),fetch("http://localhost:8000/api/stream_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),d==="click"&&typeof window.sendLogToPython=="function"){let p=n.parentElement?.tagName?.toLowerCase()||null,y=Array.from(n.parentElement?.children||[]).filter(b=>b!==n).map(b=>b.innerText.trim()).filter(Boolean);window.sendLogToPython({event:"click",selector:m,elementMeta:{tag:n.tagName.toLowerCase(),attributes:h(n),innerText:n.innerText?.trim(),parentTag:p,siblingText:y},timestamp:new Date().toISOString(),pageUrl:window.location.href})}};["click","focus","change"].forEach(a=>{document.addEventListener(a,e,!0)}),document.addEventListener("blur",a=>{let c=a.target;c.matches("input, textarea, select")&&e(a,{action:"type",value:c.value})},!0);let i=()=>{typeof window.sendUrlChangeToPython=="function"&&window.sendUrlChangeToPython(window.location.href)},r=()=>{document.body?new MutationObserver(i).observe(document.body,{childList:!0,subtree:!0}):setTimeout(r,100)};r();let u=a=>{let c=history[a];history[a]=function(...f){c.apply(this,f),i()}};window.addEventListener("popstate",i),i(),u("pushState"),u("replaceState")})();})();
