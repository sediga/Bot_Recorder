(()=>{function g(r){if(!r||r===document||r.nodeType!==1)return"";let t=r.closest('button, [role="button"], a, input[type="button"], [tabindex]')||r;if(t.id)return`#${CSS.escape(t.id)}`;if(t.name)return`[name='${CSS.escape(t.name)}']`;if(t.getAttribute("data-testid"))return`[data-testid='${CSS.escape(t.getAttribute("data-testid"))}']`;if(t.getAttribute("aria-label"))return`[aria-label='${CSS.escape(t.getAttribute("aria-label"))}']`;if(t.placeholder)return`[placeholder='${CSS.escape(t.placeholder)}']`;let s=t.tagName.toLowerCase(),m=t.getAttribute("type"),f=t.getAttribute("role"),o=t.textContent.trim().replace(/\s+/g," ").replace(/["']/g,"");if(s==="button"&&o)return`button:has-text("${o}")`;if(s==="input"&&m==="button"&&t.value)return`input[type="button"][value="${CSS.escape(t.value)}"]`;if((f==="button"||f==="link")&&o)return`[role='${f}']:has-text("${o}")`;if(s==="a"&&o)return`a:has-text("${o}")`;if(["span","div","p","strong","li","label"].includes(s)&&o.length>0&&o.length<100)return`${s}:has-text("${o}")`;let p=[],e=t;for(;e&&e.nodeType===1&&e!==document.body;){let l=e.tagName.toLowerCase(),n=[...e.classList].filter(a=>!/^\d+$/.test(a));n.length&&(l+="."+n.map(a=>CSS.escape(a)).join("."));let c=Array.from(e.parentNode.children).filter(a=>a.tagName===e.tagName);c.length>1&&(l+=`:nth-of-type(${c.indexOf(e)+1})`),p.unshift(l),e=e.parentNode}return p.join(" > ")}(function(){if(window.__recorderInjected)return;window.__recorderInjected=!0;let r,i=null,t={selector:null,timestamp:0},s={selector:null,timestamp:0},m=e=>{let l=e.target,n=l.closest('a, button, input[type="button"], [role="button"]')||l,c=e.type;if(!n||typeof window.sendEventToPython!="function")return;let a=g(n),d=Date.now();if(c==="click"){if(a===t.selector&&d-t.timestamp<150)return;t={selector:a,timestamp:d}}if(c==="focus"){if(a===s.selector&&d-s.timestamp<150)return;s={selector:a,timestamp:d}}if(c==="input"&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA"))clearTimeout(r),i=n,r=setTimeout(()=>{if(i){let u={action:"type",selector:g(i),timestamp:Date.now(),value:i.value,url:window.location.href};window.sendEventToPython(u),fetch("http://localhost:8000/api/stream_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),i=null}},800);else{let u={action:c,selector:a,timestamp:d,value:n.value||void 0,url:window.location.href};window.sendEventToPython(u),fetch("http://localhost:8000/api/stream_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}if(c==="click"&&typeof window.sendLogToPython=="function"){let u=n.parentElement?.tagName?.toLowerCase()||null,w=Array.from(n.parentElement?.children||[]).filter(h=>h!==n).map(h=>h.innerText.trim()).filter(Boolean);window.sendLogToPython({event:"click",selector:a,elementMeta:{tag:n.tagName.toLowerCase(),attributes:y(n),innerText:n.innerText.trim(),parentTag:u,siblingText:w},timestamp:new Date().toISOString(),pageUrl:window.location.href})}},f=e=>e.replace(/"/g,'\\"').replace(/'/g,"\\'");["click","focus","blur","change","input","mousedown"].forEach(e=>{document.addEventListener(e,m,!0)});let o=()=>{typeof window.sendUrlChangeToPython=="function"&&window.sendUrlChangeToPython(window.location.href)};new MutationObserver(o).observe(document.body,{childList:!0,subtree:!0});let p=e=>{let l=history[e];history[e]=function(...n){l.apply(this,n),o()}};p("pushState"),p("replaceState"),window.addEventListener("popstate",o),o()})();function y(r){let i={};for(let t of r.attributes)i[t.name]=t.value;return i}})();
