(()=>{function h(r){if(!r||r===document||r.nodeType!==1)return"";let t=r.closest('button, [role="button"], a, input[type="button"], [tabindex]')||r;if(t.id)return`#${CSS.escape(t.id)}`;if(t.name)return`[name='${CSS.escape(t.name)}']`;if(t.getAttribute("data-testid"))return`[data-testid='${CSS.escape(t.getAttribute("data-testid"))}']`;if(t.getAttribute("aria-label"))return`[aria-label='${CSS.escape(t.getAttribute("aria-label"))}']`;if(t.placeholder)return`[placeholder='${CSS.escape(t.placeholder)}']`;let s=t.tagName.toLowerCase(),m=t.getAttribute("type"),f=t.getAttribute("role"),o=t.textContent.trim().replace(/\s+/g," ").replace(/["']/g,"");if(s==="button"&&o)return`button:has-text("${o}")`;if(s==="input"&&m==="button"&&t.value)return`input[type="button"][value="${CSS.escape(t.value)}"]`;if((f==="button"||f==="link")&&o)return`[role='${f}']:has-text("${o}")`;if(s==="a"&&o)return`a:has-text("${o}")`;if(["span","div","p","strong","li","label"].includes(s)&&o.length>0&&o.length<100)return`${s}:has-text("${o}")`;let p=[],e=t;for(;e&&e.nodeType===1&&e!==document.body;){let c=e.tagName.toLowerCase(),n=[...e.classList].filter(a=>!/^\d+$/.test(a));n.length&&(c+="."+n.map(a=>CSS.escape(a)).join("."));let u=Array.from(e.parentNode.children).filter(a=>a.tagName===e.tagName);u.length>1&&(c+=`:nth-of-type(${u.indexOf(e)+1})`),p.unshift(c),e=e.parentNode}return p.join(" > ")}(function(){if(window.__recorderInjected)return;window.__recorderInjected=!0;let r,i=null,t={selector:null,timestamp:0},s={selector:null,timestamp:0},m=e=>{let c=e.target,n=c.closest('a, button, input[type="button"], [role="button"]')||c,u=e.type;if(!n||typeof window.sendEventToPython!="function")return;let a=h(n),d=Date.now();if(u==="click"){if(a===t.selector&&d-t.timestamp<150)return;t={selector:a,timestamp:d}}if(u==="focus"){if(a===s.selector&&d-s.timestamp<150)return;s={selector:a,timestamp:d}}if(u==="input"&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA"))clearTimeout(r),i=n,r=setTimeout(()=>{if(i){let l={action:"type",selector:h(i),timestamp:Date.now(),value:i.value,url:window.location.href};window.sendEventToPython(l),window.parent.postMessage({type:"recorded-event",data:l},"*"),fetch("http://localhost:8000/api/stream_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),i=null}},800);else{let l={action:u,selector:a,timestamp:d,value:n.value||void 0,url:window.location.href};window.sendEventToPython(l),window.parent.postMessage({type:"recorded-event",data:l},"*"),fetch("http://localhost:8000/api/stream_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}if(u==="click"&&typeof window.sendLogToPython=="function"){let l=n.parentElement?.tagName?.toLowerCase()||null,w=Array.from(n.parentElement?.children||[]).filter(g=>g!==n).map(g=>g.innerText.trim()).filter(Boolean);window.sendLogToPython({event:"click",selector:a,elementMeta:{tag:n.tagName.toLowerCase(),attributes:y(n),innerText:n.innerText.trim(),parentTag:l,siblingText:w},timestamp:new Date().toISOString(),pageUrl:window.location.href})}},f=e=>e.replace(/"/g,'\\"').replace(/'/g,"\\'");["click","focus","change","input"].forEach(e=>{document.addEventListener(e,m,!0)});let o=()=>{typeof window.sendUrlChangeToPython=="function"&&window.sendUrlChangeToPython(window.location.href)};new MutationObserver(o).observe(document.body,{childList:!0,subtree:!0});let p=e=>{let c=history[e];history[e]=function(...n){c.apply(this,n),o()}};p("pushState"),p("replaceState"),window.addEventListener("popstate",o),o()})();function y(r){let i={};for(let t of r.attributes)i[t.name]=t.value;return i}})();
